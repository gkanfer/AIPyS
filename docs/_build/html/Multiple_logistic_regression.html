<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Logistic regression &mdash; AIPyS  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> AIPyS
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install/index.html">Installing AIPyS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tutorial.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="API.html">AIPyS modules</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">AIPyS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Logistic regression</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Multiple_logistic_regression.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="c1">#pd.set_option(&#39;display.max_columns&#39;, 500)</span>
<span class="c1">#pd.set_option(&#39;display.max_rows&#39;, 500)</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">jupyter_dash</span> <span class="kn">import</span> <span class="n">JupyterDash</span>
<span class="kn">import</span> <span class="nn">dash</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span> <span class="n">dcc</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span> <span class="n">html</span>
<span class="kn">from</span> <span class="nn">dash.dependencies</span> <span class="kn">import</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Output</span>
<span class="kn">import</span> <span class="nn">dash_bootstrap_components</span> <span class="k">as</span> <span class="nn">dbc</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageEnhance</span><span class="p">,</span> <span class="n">ImageDraw</span><span class="p">,</span><span class="n">ImageFont</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="c1">#sns.set()</span>
<span class="kn">import</span> <span class="nn">arviz</span> <span class="k">as</span> <span class="nn">az</span>
<span class="kn">import</span> <span class="nn">pymc3</span> <span class="k">as</span> <span class="nn">pm</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">theano.tensor</span> <span class="k">as</span> <span class="nn">tt</span>
<span class="kn">import</span> <span class="nn">patsy</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="c1"># import plotnine</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">preprocessing</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="c1"># import plotnine</span>
<span class="c1"># from plotnine.data import economics</span>
<span class="c1"># from plotnine import *</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>

<span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">measure</span><span class="p">,</span> <span class="n">restoration</span><span class="p">,</span><span class="n">morphology</span>
<span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">io</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">measure</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">img_as_ubyte</span>
<span class="kn">from</span> <span class="nn">skimage.draw</span> <span class="kn">import</span> <span class="n">disk</span>
<span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">measure</span><span class="p">,</span> <span class="n">restoration</span><span class="p">,</span><span class="n">morphology</span>

<span class="n">RANDOM_SEED</span> <span class="o">=</span> <span class="mi">8927</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">RANDOM_SEED</span><span class="p">)</span>


<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &#39;retina&#39;
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;F:\HAB_2\PrinzScreen\training_classfication&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">AIPS_cellpose</span> <span class="k">as</span> <span class="n">AC</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">AIPS_file_display</span> <span class="k">as</span> <span class="n">AFD</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
WARNING (theano.tensor.blas): Using NumPy C-API based implementation for BLAS functions.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
3.11.5
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\tqdm\auto.py:22: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm
F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\skimage\viewer\utils\__init__.py:1: UserWarning: Recommended matplotlib backend is `Agg` for full skimage.viewer functionality.
  from .core import *
</pre></div></div>
</div>
<section id="Logistic-regression">
<h1>Logistic regression<a class="headerlink" href="#Logistic-regression" title="Permalink to this headline"></a></h1>
<div class="line-block">
<div class="line">Decay formula:</div>
<div class="line-block">
<div class="line">$ Signal(t) = a <span class="math">\times `Signal(t0) :nbsphinx-math:</span>times <cite>e^{-b :nbsphinx-math:</cite>times <a href="#id1"><span class="problematic" id="id2">`</span></a>kernel}$</div>
<div class="line"><span class="math notranslate nohighlight">\(b = - \frac {ln \frac {Signal(t)}{Signal(t0)}}{Kernel}\)</span> Remove the minus sign for compatebility with logistic</div>
</div>
<div class="line">Add a parmetre and beta $ <span class="math">\theta `= logistic(a + :nbsphinx-math:</span>beta <cite>:nbsphinx-math:</cite>frac {ln frac {Signal(t)}{Signal(t0)}}{Kernel}`)$ —</div>
</div>
<ul class="simple">
<li><p>☐ Divide signal by median per image, add class culomn and remove all the zeros</p></li>
<li><p>☐ Add Signal start (Signal(t0)) and Signal(t)</p></li>
<li><p>☐ Plot b per image</p></li>
<li><p>☐ Remove ambiguous signal</p></li>
<li><p>☐ Concatenate data_frames</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_class_select</span><span class="p">(</span><span class="n">ones_</span><span class="p">,</span><span class="n">zero_</span><span class="p">,</span><span class="n">table</span><span class="p">):</span>
    <span class="n">table</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;image_group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">ones_</span><span class="p">,</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;image_group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">ones_</span><span class="p">,:],</span>
                   <span class="n">table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;image_group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">zero_</span><span class="p">,:]),</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">add_rate_column</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">un</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;image_group&#39;</span><span class="p">])</span>
    <span class="c1"># adding Signal start and finsh</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Nt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Kernel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">raius_list</span><span class="o">.</span><span class="n">values</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">un_</span> <span class="ow">in</span> <span class="n">un</span><span class="p">:</span>
        <span class="n">df_temp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;image_group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">==</span><span class="n">un_</span><span class="p">,:]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;image_group&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">un_</span><span class="p">,</span><span class="s1">&#39;Nt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">df_temp</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span><span class="nb">len</span><span class="p">(</span><span class="n">df_temp</span><span class="p">))</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">image_signal_norm</span><span class="o">.</span><span class="n">values</span><span class="o">/</span><span class="n">df</span><span class="o">.</span><span class="n">Nt</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">/</span><span class="n">df</span><span class="o">.</span><span class="n">Kernel</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="c1"># Keep until 20</span>
    <span class="k">for</span> <span class="n">un_</span> <span class="ow">in</span> <span class="n">un</span><span class="p">:</span>
        <span class="n">df_temp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;image_group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">==</span><span class="n">un_</span><span class="p">,:]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;image_group&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">un_</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df_temp</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span>
<span class="c1">#    plt.figure(figsize=(5, 20))</span>
<span class="c1">#     sns.catplot(x=&quot;image_group&quot;, y=&quot;b&quot;,</span>
<span class="c1">#             hue=&quot;class&quot;, palette=[&quot;m&quot;, &quot;g&quot;],</span>
<span class="c1">#             data=df,</span>
<span class="c1">#            height=5, # make the plot 5 units high</span>
<span class="c1">#             aspect=4)</span>
    <span class="k">return</span> <span class="n">df</span>


<span class="k">def</span> <span class="nf">Class_table</span><span class="p">(</span><span class="n">path_Table_img</span><span class="p">,</span><span class="n">file_name</span><span class="p">,</span><span class="n">path_class</span><span class="p">,</span><span class="n">file_class</span><span class="p">):</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_Table_img</span><span class="p">,</span><span class="n">file_name</span><span class="p">))</span>
    <span class="n">table</span><span class="p">[</span><span class="s1">&#39;image_signal_norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">image_signal</span><span class="o">.</span><span class="n">values</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;raius_list&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;image_signal&#39;</span><span class="p">])</span>
    <span class="c1"># upload class</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_class</span><span class="p">,</span><span class="n">file_class</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">class_r</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="n">Pheno_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">class_r</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)]</span>
    <span class="n">zero_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">zz</span> <span class="k">for</span> <span class="n">zz</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Pheno_list</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">if</span> <span class="n">zz</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Pheno_list</span><span class="p">]</span>
    <span class="c1">### Adding classes</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Pheno_list</span><span class="p">)):</span>
        <span class="n">df_temp</span> <span class="o">=</span> <span class="n">add_class_select</span><span class="p">(</span><span class="n">Pheno_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">zero_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">table</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">df</span><span class="p">,</span><span class="n">df_temp</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">df_rate</span> <span class="o">=</span> <span class="n">add_rate_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">df_rate</span><span class="p">[</span><span class="s1">&#39;Image_name_unique&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_name</span>
    <span class="k">return</span> <span class="n">df_rate</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;F:\HAB_2\PrinzScreen\output_lab_meeting\Kernel_80_mix_0to6&#39;</span>
<span class="n">path_class</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;F:\HAB_2\PrinzScreen\output_lab_meeting\Kernel_80_mix_0to6\class_update&#39;</span> <span class="c1"># update from Remove_obser...</span>

<span class="n">Table_mix_0</span> <span class="o">=</span> <span class="n">Class_table</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;table_img0.csv&#39;</span><span class="p">,</span><span class="n">path_class</span><span class="p">,</span><span class="s1">&#39;class_0.txt&#39;</span><span class="p">)</span>
<span class="n">Table_mix_1</span> <span class="o">=</span> <span class="n">Class_table</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;table_img1.csv&#39;</span><span class="p">,</span><span class="n">path_class</span><span class="p">,</span><span class="s1">&#39;class_1.txt&#39;</span><span class="p">)</span>
<span class="n">Table_mix_2</span> <span class="o">=</span> <span class="n">Class_table</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;table_img2.csv&#39;</span><span class="p">,</span><span class="n">path_class</span><span class="p">,</span><span class="s1">&#39;class_2.txt&#39;</span><span class="p">)</span>
<span class="n">Table_mix_3</span> <span class="o">=</span> <span class="n">Class_table</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;table_img3.csv&#39;</span><span class="p">,</span><span class="n">path_class</span><span class="p">,</span><span class="s1">&#39;class_3.txt&#39;</span><span class="p">)</span>
<span class="n">Table_mix_4</span> <span class="o">=</span> <span class="n">Class_table</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;table_img4.csv&#39;</span><span class="p">,</span><span class="n">path_class</span><span class="p">,</span><span class="s1">&#39;class_4.txt&#39;</span><span class="p">)</span>
<span class="n">Table_mix_5</span> <span class="o">=</span> <span class="n">Class_table</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;table_img5.csv&#39;</span><span class="p">,</span><span class="n">path_class</span><span class="p">,</span><span class="s1">&#39;class_5.txt&#39;</span><span class="p">)</span>
<span class="n">Table_mix_6</span> <span class="o">=</span> <span class="n">Class_table</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;table_img6.csv&#39;</span><span class="p">,</span><span class="n">path_class</span><span class="p">,</span><span class="s1">&#39;class_6.txt&#39;</span><span class="p">)</span>
<span class="n">Table_sum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">Table_mix_0</span><span class="p">,</span><span class="n">Table_mix_1</span><span class="p">,</span><span class="n">Table_mix_2</span><span class="p">,</span><span class="n">Table_mix_3</span><span class="p">,</span><span class="n">Table_mix_4</span><span class="p">,</span><span class="n">Table_mix_5</span><span class="p">,</span><span class="n">Table_mix_6</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Table_sum</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\ipykernel_launcher.py:5: FutureWarning: In a future version of pandas all arguments of concat except for the argument &#39;objs&#39; will be keyword-only
  &#34;&#34;&#34;
F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\ipykernel_launcher.py:42: FutureWarning: In a future version of pandas all arguments of concat except for the argument &#39;objs&#39; will be keyword-only
F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\ipykernel_launcher.py:11: FutureWarning: In a future version of pandas all arguments of concat except for the argument &#39;objs&#39; will be keyword-only
  # This is added back by InteractiveShellApp.init_path()
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>image_signal</th>
      <th>raius_list</th>
      <th>image_group</th>
      <th>image_signal_norm</th>
      <th>class</th>
      <th>Nt</th>
      <th>Kernel</th>
      <th>b</th>
      <th>Image_name_unique</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>17680</th>
      <td>17680</td>
      <td>3279.715582</td>
      <td>0</td>
      <td>221</td>
      <td>1.892512</td>
      <td>1.0</td>
      <td>1.892512</td>
      <td>1</td>
      <td>0.019165</td>
      <td>table_img0.csv</td>
    </tr>
    <tr>
      <th>17681</th>
      <td>17681</td>
      <td>3243.717554</td>
      <td>1</td>
      <td>221</td>
      <td>1.871740</td>
      <td>1.0</td>
      <td>1.892512</td>
      <td>2</td>
      <td>0.019165</td>
      <td>table_img0.csv</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Decay-rate-(b)-as-input-for-Logistic-regression">
<h1>Decay rate (b) as input for Logistic regression<a class="headerlink" href="#Decay-rate-(b)-as-input-for-Logistic-regression" title="Permalink to this headline"></a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">un_Image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">Table_sum</span><span class="p">[</span><span class="s1">&#39;Image_name_unique&#39;</span><span class="p">])</span>
<span class="n">rate</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">image_group</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Image_name_unique</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">class_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">un_Image</span><span class="p">:</span>
    <span class="n">table_temp</span> <span class="o">=</span> <span class="n">Table_sum</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Table_sum</span><span class="p">[</span><span class="s2">&quot;Image_name_unique&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">image</span><span class="p">,:]</span>
    <span class="n">un_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">table_temp</span><span class="p">[</span><span class="s1">&#39;image_group&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">un_num</span><span class="p">:</span>
        <span class="n">rate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">table_temp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">table_temp</span><span class="p">[</span><span class="s2">&quot;image_group&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">num</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">image_group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="n">class_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">table_temp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">table_temp</span><span class="p">[</span><span class="s2">&quot;image_group&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">num</span><span class="p">,</span><span class="s1">&#39;class&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">df_collect</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;image_group&#39;</span><span class="p">:</span><span class="n">image_group</span><span class="p">,</span><span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">rate</span><span class="p">,</span><span class="s1">&#39;class_list&#39;</span><span class="p">:</span><span class="n">class_list</span><span class="p">})</span>
<span class="n">df_collect</span> <span class="o">=</span> <span class="n">df_collect</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_collect</span><span class="p">))</span> <span class="c1">#suffle</span>
<span class="n">df_train</span> <span class="o">=</span> <span class="n">df_collect</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">120</span><span class="p">,:]</span>
<span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;unique&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_train</span><span class="p">))</span>
<span class="n">df_test</span> <span class="o">=</span> <span class="n">df_collect</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">121</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">df_collect</span><span class="p">),:]</span>
<span class="n">df_test</span><span class="p">[</span><span class="s1">&#39;unique&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_test</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\ipykernel_launcher.py:16: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  app.launch_new_instance()
F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\ipykernel_launcher.py:18: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rate</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">rate</span><span class="o">.</span><span class="n">values</span>
<span class="n">y_0</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">class_list</span><span class="o">.</span><span class="n">values</span>
<span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">model_logistic_basic</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">pm</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">pm</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">mu</span><span class="p">)))</span>
    <span class="n">bd</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s1">&#39;bd&#39;</span><span class="p">,</span><span class="o">-</span><span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="p">)</span>
    <span class="n">yl</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Bernoulli</span><span class="p">(</span><span class="s1">&#39;yl&#39;</span><span class="p">,</span><span class="n">theta</span><span class="p">,</span><span class="n">observed</span> <span class="o">=</span> <span class="n">y_0</span><span class="p">)</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">4000</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span> <span class="n">target_accept</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span><span class="n">random_seed</span><span class="o">=</span><span class="n">RANDOM_SEED</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\deprecat\classic.py:215: FutureWarning: In v4.0, pm.sample will return an `arviz.InferenceData` object instead of a `MultiTrace` by default. You can pass return_inferencedata=True or return_inferencedata=False to be safe and silence this warning.
  return wrapped_(*args_, **kwargs_)
Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [b, a]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
  <progress value='32000' class='' max='32000' style='width:300px; height:20px; vertical-align: middle;'></progress>
  100.00% [32000/32000 00:26<00:00 Sampling 4 chains, 0 divergences]
</div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Sampling 4 chains for 4_000 tune and 4_000 draw iterations (16_000 + 16_000 draws total) took 61 seconds.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chain_1</span> <span class="o">=</span> <span class="n">trace</span><span class="p">[</span><span class="mi">1000</span><span class="p">:]</span>
<span class="n">pm</span><span class="o">.</span><span class="n">traceplot</span><span class="p">(</span><span class="n">chain_1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\ipykernel_launcher.py:2: DeprecationWarning: The function `traceplot` from PyMC3 is just an alias for `plot_trace` from ArviZ. Please switch to `pymc3.plot_trace` or `arviz.plot_trace`.

Got error No model on context stack. trying to find log_likelihood in translation.
F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\arviz\data\io_pymc3_3x.py:102: FutureWarning: Using `from_pymc3` without the model will be deprecated in a future release. Not using the model will return less accurate and less useful results. Make sure you use the model argument or call from_pymc3 within a model context.
  FutureWarning,
Got error No model on context stack. trying to find log_likelihood in translation.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[&lt;AxesSubplot:title={&#39;center&#39;:&#39;a&#39;}&gt;,
        &lt;AxesSubplot:title={&#39;center&#39;:&#39;a&#39;}&gt;],
       [&lt;AxesSubplot:title={&#39;center&#39;:&#39;b&#39;}&gt;,
        &lt;AxesSubplot:title={&#39;center&#39;:&#39;b&#39;}&gt;],
       [&lt;AxesSubplot:title={&#39;center&#39;:&#39;theta&#39;}&gt;,
        &lt;AxesSubplot:title={&#39;center&#39;:&#39;theta&#39;}&gt;],
       [&lt;AxesSubplot:title={&#39;center&#39;:&#39;bd&#39;}&gt;,
        &lt;AxesSubplot:title={&#39;center&#39;:&#39;bd&#39;}&gt;]], dtype=object)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Multiple_logistic_regression_7_2.png" class="no-scaled-link" src="_images/Multiple_logistic_regression_7_2.png" style="width: 687px; height: 480px;" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pm</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Got error No model on context stack. trying to find log_likelihood in translation.
F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\arviz\data\io_pymc3_3x.py:102: FutureWarning: Using `from_pymc3` without the model will be deprecated in a future release. Not using the model will return less accurate and less useful results. Make sure you use the model argument or call from_pymc3 within a model context.
  FutureWarning,
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_3%</th>
      <th>hdi_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>1.609</td>
      <td>0.315</td>
      <td>1.026</td>
      <td>2.212</td>
      <td>0.005</td>
      <td>0.003</td>
      <td>4783.0</td>
      <td>5411.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>b</th>
      <td>-50.345</td>
      <td>7.600</td>
      <td>-65.050</td>
      <td>-36.577</td>
      <td>0.110</td>
      <td>0.078</td>
      <td>4776.0</td>
      <td>5111.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>theta[0]</th>
      <td>0.228</td>
      <td>0.048</td>
      <td>0.144</td>
      <td>0.322</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>9742.0</td>
      <td>8482.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>theta[1]</th>
      <td>0.626</td>
      <td>0.050</td>
      <td>0.532</td>
      <td>0.720</td>
      <td>0.001</td>
      <td>0.000</td>
      <td>6673.0</td>
      <td>8038.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>theta[2]</th>
      <td>0.226</td>
      <td>0.048</td>
      <td>0.140</td>
      <td>0.317</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>9686.0</td>
      <td>8482.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>theta[116]</th>
      <td>0.195</td>
      <td>0.046</td>
      <td>0.115</td>
      <td>0.286</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>8908.0</td>
      <td>8185.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>theta[117]</th>
      <td>0.335</td>
      <td>0.050</td>
      <td>0.244</td>
      <td>0.432</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>11606.0</td>
      <td>8795.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>theta[118]</th>
      <td>0.518</td>
      <td>0.050</td>
      <td>0.421</td>
      <td>0.609</td>
      <td>0.001</td>
      <td>0.000</td>
      <td>9830.0</td>
      <td>8777.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>theta[119]</th>
      <td>0.637</td>
      <td>0.050</td>
      <td>0.542</td>
      <td>0.730</td>
      <td>0.001</td>
      <td>0.000</td>
      <td>6476.0</td>
      <td>7909.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>bd</th>
      <td>0.032</td>
      <td>0.004</td>
      <td>0.024</td>
      <td>0.040</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>10384.0</td>
      <td>8377.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
<p>123 rows × 9 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">theta</span> <span class="o">=</span> <span class="n">trace</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rate</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span><span class="n">theta</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span><span class="n">color</span> <span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">trace</span><span class="p">[</span><span class="s1">&#39;bd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">bd_hdi</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">hdi</span><span class="p">(</span><span class="n">trace</span><span class="p">[</span><span class="s1">&#39;bd&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">bd_hdi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">bd_hdi</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span><span class="n">y_0</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x277340b1f88&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Multiple_logistic_regression_9_1.png" class="no-scaled-link" src="_images/Multiple_logistic_regression_9_1.png" style="width: 380px; height: 248px;" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[96]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">classify</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">thold</span><span class="p">):</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">trace</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">+</span> <span class="n">trace</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="n">n</span>
    <span class="n">prob</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span><span class="p">(</span><span class="mi">1</span>  <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">mu</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">prob</span><span class="p">,</span> <span class="n">prob</span> <span class="o">&gt;</span> <span class="n">thold</span>
<span class="n">rate</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">rate</span><span class="o">.</span><span class="n">values</span>
<span class="n">td</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">prob</span><span class="p">,</span><span class="n">prediction</span> <span class="o">=</span> <span class="n">classify</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span><span class="n">td</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[97]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">confusion_matrix</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df_train</span><span class="o">.</span><span class="n">class_list</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">cm_display</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">ConfusionMatrixDisplay</span><span class="p">(</span><span class="n">confusion_matrix</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">display_labels</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">])</span>
<span class="n">cm_display</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Multiple_logistic_regression_11_0.png" class="no-scaled-link" src="_images/Multiple_logistic_regression_11_0.png" style="width: 324px; height: 261px;" />
</div>
</div>
</section>
<section id="Test-samples-prediction">
<h1>Test samples prediction<a class="headerlink" href="#Test-samples-prediction" title="Permalink to this headline"></a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[81]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">classify</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">thold</span><span class="p">):</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">trace</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">+</span> <span class="n">trace</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="n">n</span>
    <span class="n">prob</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span><span class="p">(</span><span class="mi">1</span>  <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">mu</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">prob</span><span class="p">,</span> <span class="n">prob</span> <span class="o">&gt;</span> <span class="n">thold</span>
<span class="n">rate</span> <span class="o">=</span> <span class="n">df_test</span><span class="o">.</span><span class="n">rate</span><span class="o">.</span><span class="n">values</span>
<span class="n">td</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">prob</span><span class="p">,</span><span class="n">prediction</span> <span class="o">=</span> <span class="n">classify</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span><span class="n">td</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[82]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[82]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([0, 0, 0, 1, 1, 0, 1, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1,
       0, 0, 1, 1, 0, 0, 0])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[86]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df_test</span><span class="o">.</span><span class="n">class_list</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[86]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1,
       0, 0, 1, 1, 0, 0, 0])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[88]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Multiple_logistic_regression_16_1.png" class="no-scaled-link" src="_images/Multiple_logistic_regression_16_1.png" style="width: 391px; height: 261px;" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[92]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">confusion_matrix</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df_test</span><span class="o">.</span><span class="n">class_list</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">cm_display</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">ConfusionMatrixDisplay</span><span class="p">(</span><span class="n">confusion_matrix</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">display_labels</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">])</span>
<span class="n">cm_display</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[93]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Multiple_logistic_regression_18_0.png" class="no-scaled-link" src="_images/Multiple_logistic_regression_18_0.png" style="width: 324px; height: 265px;" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test Kernel 20 for prediction</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[98]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_class_select</span><span class="p">(</span><span class="n">ones_</span><span class="p">,</span><span class="n">zero_</span><span class="p">,</span><span class="n">table</span><span class="p">):</span>
    <span class="n">table</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;image_group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">ones_</span><span class="p">,</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;image_group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">ones_</span><span class="p">,:],</span>
                   <span class="n">table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;image_group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">zero_</span><span class="p">,:]),</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">add_rate_column</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">un</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;image_group&#39;</span><span class="p">])</span>
    <span class="c1"># adding Signal start and finsh</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Nt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Kernel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">raius_list</span><span class="o">.</span><span class="n">values</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">un_</span> <span class="ow">in</span> <span class="n">un</span><span class="p">:</span>
        <span class="n">df_temp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;image_group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">==</span><span class="n">un_</span><span class="p">,:]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;image_group&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">un_</span><span class="p">,</span><span class="s1">&#39;Nt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">df_temp</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span><span class="nb">len</span><span class="p">(</span><span class="n">df_temp</span><span class="p">))</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">image_signal_norm</span><span class="o">.</span><span class="n">values</span><span class="o">/</span><span class="n">df</span><span class="o">.</span><span class="n">Nt</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">/</span><span class="n">df</span><span class="o">.</span><span class="n">Kernel</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;b20&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Keep until 20</span>
    <span class="k">for</span> <span class="n">un_</span> <span class="ow">in</span> <span class="n">un</span><span class="p">:</span>
        <span class="n">df_temp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;image_group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">==</span><span class="n">un_</span><span class="p">,:]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;image_group&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">un_</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df_temp</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;image_group&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">un_</span><span class="p">,</span><span class="s1">&#39;b20&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_temp</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span>

<span class="c1">#    plt.figure(figsize=(5, 20))</span>
<span class="c1">#     sns.catplot(x=&quot;image_group&quot;, y=&quot;b&quot;,</span>
<span class="c1">#             hue=&quot;class&quot;, palette=[&quot;m&quot;, &quot;g&quot;],</span>
<span class="c1">#             data=df,</span>
<span class="c1">#            height=5, # make the plot 5 units high</span>
<span class="c1">#             aspect=4)</span>
    <span class="k">return</span> <span class="n">df</span>


<span class="k">def</span> <span class="nf">Class_table</span><span class="p">(</span><span class="n">path_Table_img</span><span class="p">,</span><span class="n">file_name</span><span class="p">,</span><span class="n">path_class</span><span class="p">,</span><span class="n">file_class</span><span class="p">):</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_Table_img</span><span class="p">,</span><span class="n">file_name</span><span class="p">))</span>
    <span class="n">table</span><span class="p">[</span><span class="s1">&#39;image_signal_norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">image_signal</span><span class="o">.</span><span class="n">values</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;raius_list&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;image_signal&#39;</span><span class="p">])</span>
    <span class="c1"># upload class</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_class</span><span class="p">,</span><span class="n">file_class</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">class_r</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="n">Pheno_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">class_r</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)]</span>
    <span class="n">zero_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">zz</span> <span class="k">for</span> <span class="n">zz</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Pheno_list</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">if</span> <span class="n">zz</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Pheno_list</span><span class="p">]</span>
    <span class="c1">### Adding classes</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Pheno_list</span><span class="p">)):</span>
        <span class="n">df_temp</span> <span class="o">=</span> <span class="n">add_class_select</span><span class="p">(</span><span class="n">Pheno_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">zero_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">table</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">df</span><span class="p">,</span><span class="n">df_temp</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">df_rate</span> <span class="o">=</span> <span class="n">add_rate_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">df_rate</span><span class="p">[</span><span class="s1">&#39;Image_name_unique&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_name</span>
    <span class="k">return</span> <span class="n">df_rate</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[99]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;F:\HAB_2\PrinzScreen\output_lab_meeting\Kernel_80_mix_0to6&#39;</span>
<span class="n">path_class</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;F:\HAB_2\PrinzScreen\output_lab_meeting\Kernel_80_mix_0to6\class_update&#39;</span> <span class="c1"># update from Remove_obser...</span>

<span class="n">Table_mix_0</span> <span class="o">=</span> <span class="n">Class_table</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;table_img0.csv&#39;</span><span class="p">,</span><span class="n">path_class</span><span class="p">,</span><span class="s1">&#39;class_0.txt&#39;</span><span class="p">)</span>
<span class="n">Table_mix_1</span> <span class="o">=</span> <span class="n">Class_table</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;table_img1.csv&#39;</span><span class="p">,</span><span class="n">path_class</span><span class="p">,</span><span class="s1">&#39;class_1.txt&#39;</span><span class="p">)</span>
<span class="n">Table_mix_2</span> <span class="o">=</span> <span class="n">Class_table</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;table_img2.csv&#39;</span><span class="p">,</span><span class="n">path_class</span><span class="p">,</span><span class="s1">&#39;class_2.txt&#39;</span><span class="p">)</span>
<span class="n">Table_mix_3</span> <span class="o">=</span> <span class="n">Class_table</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;table_img3.csv&#39;</span><span class="p">,</span><span class="n">path_class</span><span class="p">,</span><span class="s1">&#39;class_3.txt&#39;</span><span class="p">)</span>
<span class="n">Table_mix_4</span> <span class="o">=</span> <span class="n">Class_table</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;table_img4.csv&#39;</span><span class="p">,</span><span class="n">path_class</span><span class="p">,</span><span class="s1">&#39;class_4.txt&#39;</span><span class="p">)</span>
<span class="n">Table_mix_5</span> <span class="o">=</span> <span class="n">Class_table</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;table_img5.csv&#39;</span><span class="p">,</span><span class="n">path_class</span><span class="p">,</span><span class="s1">&#39;class_5.txt&#39;</span><span class="p">)</span>
<span class="n">Table_mix_6</span> <span class="o">=</span> <span class="n">Class_table</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;table_img6.csv&#39;</span><span class="p">,</span><span class="n">path_class</span><span class="p">,</span><span class="s1">&#39;class_6.txt&#39;</span><span class="p">)</span>
<span class="n">Table_sum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">Table_mix_0</span><span class="p">,</span><span class="n">Table_mix_1</span><span class="p">,</span><span class="n">Table_mix_2</span><span class="p">,</span><span class="n">Table_mix_3</span><span class="p">,</span><span class="n">Table_mix_4</span><span class="p">,</span><span class="n">Table_mix_5</span><span class="p">,</span><span class="n">Table_mix_6</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Table_sum</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\ipykernel_launcher.py:5: FutureWarning: In a future version of pandas all arguments of concat except for the argument &#39;objs&#39; will be keyword-only
  &#34;&#34;&#34;
F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\ipykernel_launcher.py:45: FutureWarning: In a future version of pandas all arguments of concat except for the argument &#39;objs&#39; will be keyword-only
F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\ipykernel_launcher.py:11: FutureWarning: In a future version of pandas all arguments of concat except for the argument &#39;objs&#39; will be keyword-only
  # This is added back by InteractiveShellApp.init_path()
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[99]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>image_signal</th>
      <th>raius_list</th>
      <th>image_group</th>
      <th>image_signal_norm</th>
      <th>class</th>
      <th>Nt</th>
      <th>Kernel</th>
      <th>b</th>
      <th>b20</th>
      <th>Image_name_unique</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>17680</th>
      <td>17680</td>
      <td>3279.715582</td>
      <td>0</td>
      <td>221</td>
      <td>1.892512</td>
      <td>1.0</td>
      <td>1.892512</td>
      <td>1</td>
      <td>0.019165</td>
      <td>0.026171</td>
      <td>table_img0.csv</td>
    </tr>
    <tr>
      <th>17681</th>
      <td>17681</td>
      <td>3243.717554</td>
      <td>1</td>
      <td>221</td>
      <td>1.871740</td>
      <td>1.0</td>
      <td>1.892512</td>
      <td>2</td>
      <td>0.019165</td>
      <td>0.026171</td>
      <td>table_img0.csv</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[100]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">un_Image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">Table_sum</span><span class="p">[</span><span class="s1">&#39;Image_name_unique&#39;</span><span class="p">])</span>
<span class="n">rate</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">rate_b20</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">image_group</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Image_name_unique</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">class_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">un_Image</span><span class="p">:</span>
    <span class="n">table_temp</span> <span class="o">=</span> <span class="n">Table_sum</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Table_sum</span><span class="p">[</span><span class="s2">&quot;Image_name_unique&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">image</span><span class="p">,:]</span>
    <span class="n">un_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">table_temp</span><span class="p">[</span><span class="s1">&#39;image_group&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">un_num</span><span class="p">:</span>
        <span class="n">rate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">table_temp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">table_temp</span><span class="p">[</span><span class="s2">&quot;image_group&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">num</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">rate_b20</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">table_temp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">table_temp</span><span class="p">[</span><span class="s2">&quot;image_group&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">num</span><span class="p">,</span><span class="s1">&#39;b20&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">image_group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="n">class_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">table_temp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">table_temp</span><span class="p">[</span><span class="s2">&quot;image_group&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">num</span><span class="p">,</span><span class="s1">&#39;class&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">df_collect</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;image_group&#39;</span><span class="p">:</span><span class="n">image_group</span><span class="p">,</span><span class="s1">&#39;rate&#39;</span><span class="p">:</span><span class="n">rate</span><span class="p">,</span><span class="s1">&#39;rate_b20&#39;</span><span class="p">:</span><span class="n">rate_b20</span><span class="p">,</span><span class="s1">&#39;class_list&#39;</span><span class="p">:</span><span class="n">class_list</span><span class="p">})</span>
<span class="n">df_collect</span> <span class="o">=</span> <span class="n">df_collect</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_collect</span><span class="p">))</span> <span class="c1">#suffle</span>
<span class="n">df_train</span> <span class="o">=</span> <span class="n">df_collect</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">120</span><span class="p">,:]</span>
<span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;unique&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_train</span><span class="p">))</span>
<span class="n">df_test</span> <span class="o">=</span> <span class="n">df_collect</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">121</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">df_collect</span><span class="p">),:]</span>
<span class="n">df_test</span><span class="p">[</span><span class="s1">&#39;unique&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_test</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\ipykernel_launcher.py:18: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\ipykernel_launcher.py:20: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[103]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rate</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">rate_b20</span><span class="o">.</span><span class="n">values</span>
<span class="n">y_0</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">class_list</span><span class="o">.</span><span class="n">values</span>
<span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">model_logistic_basic</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">pm</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">pm</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">mu</span><span class="p">)))</span>
    <span class="n">bd</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s1">&#39;bd&#39;</span><span class="p">,</span><span class="o">-</span><span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="p">)</span>
    <span class="n">yl</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Bernoulli</span><span class="p">(</span><span class="s1">&#39;yl&#39;</span><span class="p">,</span><span class="n">theta</span><span class="p">,</span><span class="n">observed</span> <span class="o">=</span> <span class="n">y_0</span><span class="p">)</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">4000</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span> <span class="n">target_accept</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span><span class="n">random_seed</span><span class="o">=</span><span class="n">RANDOM_SEED</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\deprecat\classic.py:215: FutureWarning: In v4.0, pm.sample will return an `arviz.InferenceData` object instead of a `MultiTrace` by default. You can pass return_inferencedata=True or return_inferencedata=False to be safe and silence this warning.
  return wrapped_(*args_, **kwargs_)
Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [b, a]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
  <progress value='32000' class='' max='32000' style='width:300px; height:20px; vertical-align: middle;'></progress>
  100.00% [32000/32000 00:26<00:00 Sampling 4 chains, 0 divergences]
</div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Sampling 4 chains for 4_000 tune and 4_000 draw iterations (16_000 + 16_000 draws total) took 58 seconds.
The number of effective samples is smaller than 25% for some parameters.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[104]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">theta</span> <span class="o">=</span> <span class="n">trace</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rate</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span><span class="n">theta</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span><span class="n">color</span> <span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">trace</span><span class="p">[</span><span class="s1">&#39;bd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">bd_hdi</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">hdi</span><span class="p">(</span><span class="n">trace</span><span class="p">[</span><span class="s1">&#39;bd&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">bd_hdi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">bd_hdi</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span><span class="n">y_0</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[104]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x2771dde1988&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Multiple_logistic_regression_24_1.png" class="no-scaled-link" src="_images/Multiple_logistic_regression_24_1.png" style="width: 372px; height: 248px;" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[105]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">classify</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">thold</span><span class="p">):</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">trace</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">+</span> <span class="n">trace</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="n">n</span>
    <span class="n">prob</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span><span class="p">(</span><span class="mi">1</span>  <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">mu</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">prob</span><span class="p">,</span> <span class="n">prob</span> <span class="o">&gt;</span> <span class="n">thold</span>
<span class="n">rate</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">rate</span><span class="o">.</span><span class="n">values</span>
<span class="n">td</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">prob</span><span class="p">,</span><span class="n">prediction</span> <span class="o">=</span> <span class="n">classify</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span><span class="n">td</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[106]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">confusion_matrix</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df_train</span><span class="o">.</span><span class="n">class_list</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">cm_display</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">ConfusionMatrixDisplay</span><span class="p">(</span><span class="n">confusion_matrix</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">display_labels</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">])</span>
<span class="n">cm_display</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Multiple_logistic_regression_26_0.png" class="no-scaled-link" src="_images/Multiple_logistic_regression_26_0.png" style="width: 324px; height: 262px;" />
</div>
</div>
</section>
<section id="Compute-b-from-1,5,10,20">
<h1>Compute b from 1,5,10,20<a class="headerlink" href="#Compute-b-from-1,5,10,20" title="Permalink to this headline"></a></h1>
<p>Adding parameter for the sequence calculation</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[108]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_class_select</span><span class="p">(</span><span class="n">ones_</span><span class="p">,</span><span class="n">zero_</span><span class="p">,</span><span class="n">table</span><span class="p">):</span>
    <span class="n">table</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;image_group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">ones_</span><span class="p">,</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;image_group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">ones_</span><span class="p">,:],</span>
                   <span class="n">table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;image_group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">zero_</span><span class="p">,:]),</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">add_rate_column</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">un</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;image_group&#39;</span><span class="p">])</span>
    <span class="c1"># adding Signal start and finsh</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Nt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Kernel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">raius_list</span><span class="o">.</span><span class="n">values</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">un_</span> <span class="ow">in</span> <span class="n">un</span><span class="p">:</span>
        <span class="n">df_temp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;image_group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">==</span><span class="n">un_</span><span class="p">,:]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;image_group&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">un_</span><span class="p">,</span><span class="s1">&#39;Nt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">df_temp</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span><span class="nb">len</span><span class="p">(</span><span class="n">df_temp</span><span class="p">))</span>
<span class="c1">#    plt.figure(figsize=(5, 20))</span>
<span class="c1">#     sns.catplot(x=&quot;image_group&quot;, y=&quot;b&quot;,</span>
<span class="c1">#             hue=&quot;class&quot;, palette=[&quot;m&quot;, &quot;g&quot;],</span>
<span class="c1">#             data=df,</span>
<span class="c1">#            height=5, # make the plot 5 units high</span>
<span class="c1">#             aspect=4)</span>
    <span class="k">return</span> <span class="n">df</span>


<span class="k">def</span> <span class="nf">Class_table</span><span class="p">(</span><span class="n">path_Table_img</span><span class="p">,</span><span class="n">file_name</span><span class="p">,</span><span class="n">path_class</span><span class="p">,</span><span class="n">file_class</span><span class="p">):</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_Table_img</span><span class="p">,</span><span class="n">file_name</span><span class="p">))</span>
    <span class="n">table</span><span class="p">[</span><span class="s1">&#39;image_signal_norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">image_signal</span><span class="o">.</span><span class="n">values</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;raius_list&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;image_signal&#39;</span><span class="p">])</span>
    <span class="c1"># upload class</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_class</span><span class="p">,</span><span class="n">file_class</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">class_r</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="n">Pheno_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">class_r</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)]</span>
    <span class="n">zero_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">zz</span> <span class="k">for</span> <span class="n">zz</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Pheno_list</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">if</span> <span class="n">zz</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Pheno_list</span><span class="p">]</span>
    <span class="c1">### Adding classes</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Pheno_list</span><span class="p">)):</span>
        <span class="n">df_temp</span> <span class="o">=</span> <span class="n">add_class_select</span><span class="p">(</span><span class="n">Pheno_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">zero_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">table</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">df</span><span class="p">,</span><span class="n">df_temp</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">df_rate</span> <span class="o">=</span> <span class="n">add_rate_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">df_rate</span><span class="p">[</span><span class="s1">&#39;Image_name_unique&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_name</span>
    <span class="k">return</span> <span class="n">df_rate</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[110]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;F:\HAB_2\PrinzScreen\output_lab_meeting\Kernel_80_mix_0to6&#39;</span>
<span class="n">path_class</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;F:\HAB_2\PrinzScreen\output_lab_meeting\Kernel_80_mix_0to6\class_update&#39;</span> <span class="c1"># update from Remove_obser...</span>

<span class="n">Table_mix_0</span> <span class="o">=</span> <span class="n">Class_table</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;table_img0.csv&#39;</span><span class="p">,</span><span class="n">path_class</span><span class="p">,</span><span class="s1">&#39;class_0.txt&#39;</span><span class="p">)</span>
<span class="n">Table_mix_1</span> <span class="o">=</span> <span class="n">Class_table</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;table_img1.csv&#39;</span><span class="p">,</span><span class="n">path_class</span><span class="p">,</span><span class="s1">&#39;class_1.txt&#39;</span><span class="p">)</span>
<span class="n">Table_mix_2</span> <span class="o">=</span> <span class="n">Class_table</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;table_img2.csv&#39;</span><span class="p">,</span><span class="n">path_class</span><span class="p">,</span><span class="s1">&#39;class_2.txt&#39;</span><span class="p">)</span>
<span class="n">Table_mix_3</span> <span class="o">=</span> <span class="n">Class_table</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;table_img3.csv&#39;</span><span class="p">,</span><span class="n">path_class</span><span class="p">,</span><span class="s1">&#39;class_3.txt&#39;</span><span class="p">)</span>
<span class="n">Table_mix_4</span> <span class="o">=</span> <span class="n">Class_table</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;table_img4.csv&#39;</span><span class="p">,</span><span class="n">path_class</span><span class="p">,</span><span class="s1">&#39;class_4.txt&#39;</span><span class="p">)</span>
<span class="n">Table_mix_5</span> <span class="o">=</span> <span class="n">Class_table</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;table_img5.csv&#39;</span><span class="p">,</span><span class="n">path_class</span><span class="p">,</span><span class="s1">&#39;class_5.txt&#39;</span><span class="p">)</span>
<span class="n">Table_mix_6</span> <span class="o">=</span> <span class="n">Class_table</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;table_img6.csv&#39;</span><span class="p">,</span><span class="n">path_class</span><span class="p">,</span><span class="s1">&#39;class_6.txt&#39;</span><span class="p">)</span>
<span class="n">Table_sum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">Table_mix_0</span><span class="p">,</span><span class="n">Table_mix_1</span><span class="p">,</span><span class="n">Table_mix_2</span><span class="p">,</span><span class="n">Table_mix_3</span><span class="p">,</span><span class="n">Table_mix_4</span><span class="p">,</span><span class="n">Table_mix_5</span><span class="p">,</span><span class="n">Table_mix_6</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Table_sum</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\ipykernel_launcher.py:5: FutureWarning: In a future version of pandas all arguments of concat except for the argument &#39;objs&#39; will be keyword-only
  &#34;&#34;&#34;
F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\ipykernel_launcher.py:37: FutureWarning: In a future version of pandas all arguments of concat except for the argument &#39;objs&#39; will be keyword-only
F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\ipykernel_launcher.py:11: FutureWarning: In a future version of pandas all arguments of concat except for the argument &#39;objs&#39; will be keyword-only
  # This is added back by InteractiveShellApp.init_path()
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[110]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>image_signal</th>
      <th>raius_list</th>
      <th>image_group</th>
      <th>image_signal_norm</th>
      <th>class</th>
      <th>Nt</th>
      <th>Kernel</th>
      <th>Image_name_unique</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>17680</th>
      <td>17680</td>
      <td>3279.715582</td>
      <td>0</td>
      <td>221</td>
      <td>1.892512</td>
      <td>1.0</td>
      <td>1.892512</td>
      <td>1</td>
      <td>table_img0.csv</td>
    </tr>
    <tr>
      <th>17681</th>
      <td>17681</td>
      <td>3243.717554</td>
      <td>1</td>
      <td>221</td>
      <td>1.871740</td>
      <td>1.0</td>
      <td>1.892512</td>
      <td>2</td>
      <td>table_img0.csv</td>
    </tr>
    <tr>
      <th>17682</th>
      <td>17682</td>
      <td>3207.038659</td>
      <td>2</td>
      <td>221</td>
      <td>1.850575</td>
      <td>1.0</td>
      <td>1.892512</td>
      <td>3</td>
      <td>table_img0.csv</td>
    </tr>
    <tr>
      <th>17683</th>
      <td>17683</td>
      <td>3160.837870</td>
      <td>3</td>
      <td>221</td>
      <td>1.823915</td>
      <td>1.0</td>
      <td>1.892512</td>
      <td>4</td>
      <td>table_img0.csv</td>
    </tr>
    <tr>
      <th>17684</th>
      <td>17684</td>
      <td>3106.424852</td>
      <td>4</td>
      <td>221</td>
      <td>1.792517</td>
      <td>1.0</td>
      <td>1.892512</td>
      <td>5</td>
      <td>table_img0.csv</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>795</th>
      <td>795</td>
      <td>130.016662</td>
      <td>75</td>
      <td>9</td>
      <td>0.052068</td>
      <td>0.0</td>
      <td>0.759612</td>
      <td>76</td>
      <td>table_img6.csv</td>
    </tr>
    <tr>
      <th>796</th>
      <td>796</td>
      <td>130.003029</td>
      <td>76</td>
      <td>9</td>
      <td>0.052062</td>
      <td>0.0</td>
      <td>0.759612</td>
      <td>77</td>
      <td>table_img6.csv</td>
    </tr>
    <tr>
      <th>797</th>
      <td>797</td>
      <td>130.000000</td>
      <td>77</td>
      <td>9</td>
      <td>0.052061</td>
      <td>0.0</td>
      <td>0.759612</td>
      <td>78</td>
      <td>table_img6.csv</td>
    </tr>
    <tr>
      <th>798</th>
      <td>798</td>
      <td>129.948803</td>
      <td>78</td>
      <td>9</td>
      <td>0.052040</td>
      <td>0.0</td>
      <td>0.759612</td>
      <td>79</td>
      <td>table_img6.csv</td>
    </tr>
    <tr>
      <th>799</th>
      <td>799</td>
      <td>129.952893</td>
      <td>79</td>
      <td>9</td>
      <td>0.052042</td>
      <td>0.0</td>
      <td>0.759612</td>
      <td>80</td>
      <td>table_img6.csv</td>
    </tr>
  </tbody>
</table>
<p>12000 rows × 9 columns</p>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Table_sum</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">17680</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[111]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">un_Image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">Table_sum</span><span class="p">[</span><span class="s1">&#39;Image_name_unique&#39;</span><span class="p">])</span>
<span class="n">rate</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">rate_b20</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">image_group</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Image_name_unique</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">class_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">Table_sum</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">kernel_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">])</span>
<span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">un_Image</span><span class="p">:</span>
    <span class="n">table_temp</span> <span class="o">=</span> <span class="n">Table_sum</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Table_sum</span><span class="p">[</span><span class="s2">&quot;Image_name_unique&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">image</span><span class="p">,:]</span>
    <span class="n">un_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">table_temp</span><span class="p">[</span><span class="s1">&#39;image_group&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">un_num</span><span class="p">:</span>
        <span class="n">df_temp</span> <span class="o">=</span> <span class="n">table_temp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="p">[]),:]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">df</span><span class="p">,</span><span class="n">df_temp</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># df_collect = pd.DataFrame({&#39;image_group&#39;:image_group,&#39;rate&#39;:rate,&#39;rate_b20&#39;:rate_b20,&#39;class_list&#39;:class_list})</span>
<span class="c1"># df_collect = df_collect.sample(len(df_collect)) #suffle</span>
<span class="c1"># df_train = df_collect.iloc[:120,:]</span>
<span class="c1"># df_train[&#39;unique&#39;] = np.arange(len(df_train))</span>
<span class="c1"># df_test = df_collect.iloc[121:len(df_collect),:]</span>
<span class="c1"># df_test[&#39;unique&#39;] = np.arange(len(df_test))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-intense-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-intense-fg ansi-bold">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-green-intense-fg ansi-bold">~\AppData\Local\Temp\ipykernel_8524\1416107367.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">     11</span>     un_num <span class="ansi-yellow-intense-fg ansi-bold">=</span> np<span class="ansi-yellow-intense-fg ansi-bold">.</span>unique<span class="ansi-yellow-intense-fg ansi-bold">(</span>table_temp<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-blue-intense-fg ansi-bold">&#39;image_group&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">]</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">     12</span>     <span class="ansi-green-intense-fg ansi-bold">for</span> num <span class="ansi-green-intense-fg ansi-bold">in</span> un_num<span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">---&gt; 13</span><span class="ansi-yellow-intense-fg ansi-bold">         </span>df_temp <span class="ansi-yellow-intense-fg ansi-bold">=</span> table_temp<span class="ansi-yellow-intense-fg ansi-bold">.</span>loc<span class="ansi-yellow-intense-fg ansi-bold">[</span>table_temp<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-blue-intense-fg ansi-bold">&#39;Kernel&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">]</span><span class="ansi-yellow-intense-fg ansi-bold">==</span>kernel_ind<span class="ansi-yellow-intense-fg ansi-bold">,</span><span class="ansi-yellow-intense-fg ansi-bold">:</span><span class="ansi-yellow-intense-fg ansi-bold">]</span>
<span class="ansi-green-fg">     14</span>         df <span class="ansi-yellow-intense-fg ansi-bold">=</span> pd<span class="ansi-yellow-intense-fg ansi-bold">.</span>concat<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">(</span>df<span class="ansi-yellow-intense-fg ansi-bold">,</span>df_temp<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">,</span><span class="ansi-cyan-intense-fg ansi-bold">1</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">     15</span>

<span class="ansi-green-intense-fg ansi-bold">F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\pandas\core\ops\common.py</span> in <span class="ansi-cyan-fg">new_method</span><span class="ansi-blue-intense-fg ansi-bold">(self, other)</span>
<span class="ansi-green-fg">     67</span>         other <span class="ansi-yellow-intense-fg ansi-bold">=</span> item_from_zerodim<span class="ansi-yellow-intense-fg ansi-bold">(</span>other<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">     68</span>
<span class="ansi-green-intense-fg ansi-bold">---&gt; 69</span><span class="ansi-yellow-intense-fg ansi-bold">         </span><span class="ansi-green-intense-fg ansi-bold">return</span> method<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">,</span> other<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">     70</span>
<span class="ansi-green-fg">     71</span>     <span class="ansi-green-intense-fg ansi-bold">return</span> new_method

<span class="ansi-green-intense-fg ansi-bold">F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\pandas\core\arraylike.py</span> in <span class="ansi-cyan-fg">__eq__</span><span class="ansi-blue-intense-fg ansi-bold">(self, other)</span>
<span class="ansi-green-fg">     30</span>     <span class="ansi-yellow-intense-fg ansi-bold">@</span>unpack_zerodim_and_defer<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#34;__eq__&#34;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">     31</span>     <span class="ansi-green-intense-fg ansi-bold">def</span> __eq__<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">,</span> other<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">---&gt; 32</span><span class="ansi-yellow-intense-fg ansi-bold">         </span><span class="ansi-green-intense-fg ansi-bold">return</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_cmp_method<span class="ansi-yellow-intense-fg ansi-bold">(</span>other<span class="ansi-yellow-intense-fg ansi-bold">,</span> operator<span class="ansi-yellow-intense-fg ansi-bold">.</span>eq<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">     33</span>
<span class="ansi-green-fg">     34</span>     <span class="ansi-yellow-intense-fg ansi-bold">@</span>unpack_zerodim_and_defer<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#34;__ne__&#34;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-intense-fg ansi-bold">F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\pandas\core\series.py</span> in <span class="ansi-cyan-fg">_cmp_method</span><span class="ansi-blue-intense-fg ansi-bold">(self, other, op)</span>
<span class="ansi-green-fg">   5500</span>
<span class="ansi-green-fg">   5501</span>         <span class="ansi-green-intense-fg ansi-bold">with</span> np<span class="ansi-yellow-intense-fg ansi-bold">.</span>errstate<span class="ansi-yellow-intense-fg ansi-bold">(</span>all<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-blue-intense-fg ansi-bold">&#34;ignore&#34;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">-&gt; 5502</span><span class="ansi-yellow-intense-fg ansi-bold">             </span>res_values <span class="ansi-yellow-intense-fg ansi-bold">=</span> ops<span class="ansi-yellow-intense-fg ansi-bold">.</span>comparison_op<span class="ansi-yellow-intense-fg ansi-bold">(</span>lvalues<span class="ansi-yellow-intense-fg ansi-bold">,</span> rvalues<span class="ansi-yellow-intense-fg ansi-bold">,</span> op<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">   5503</span>
<span class="ansi-green-fg">   5504</span>         <span class="ansi-green-intense-fg ansi-bold">return</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>_construct_result<span class="ansi-yellow-intense-fg ansi-bold">(</span>res_values<span class="ansi-yellow-intense-fg ansi-bold">,</span> name<span class="ansi-yellow-intense-fg ansi-bold">=</span>res_name<span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-intense-fg ansi-bold">F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\pandas\core\ops\array_ops.py</span> in <span class="ansi-cyan-fg">comparison_op</span><span class="ansi-blue-intense-fg ansi-bold">(left, right, op)</span>
<span class="ansi-green-fg">    260</span>         <span class="ansi-green-intense-fg ansi-bold">if</span> len<span class="ansi-yellow-intense-fg ansi-bold">(</span>lvalues<span class="ansi-yellow-intense-fg ansi-bold">)</span> <span class="ansi-yellow-intense-fg ansi-bold">!=</span> len<span class="ansi-yellow-intense-fg ansi-bold">(</span>rvalues<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">    261</span>             raise ValueError(
<span class="ansi-green-intense-fg ansi-bold">--&gt; 262</span><span class="ansi-yellow-intense-fg ansi-bold">                 </span><span class="ansi-blue-intense-fg ansi-bold">&#34;Lengths must match to compare&#34;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> lvalues<span class="ansi-yellow-intense-fg ansi-bold">.</span>shape<span class="ansi-yellow-intense-fg ansi-bold">,</span> rvalues<span class="ansi-yellow-intense-fg ansi-bold">.</span>shape
<span class="ansi-green-fg">    263</span>             )
<span class="ansi-green-fg">    264</span>

<span class="ansi-red-intense-fg ansi-bold">ValueError</span>: (&#39;Lengths must match to compare&#39;, (800,), (3,))
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">path_input_table</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;F:\HAB_2\PrinzScreen\output_lab_meeting\kerenl_60_mix&#39;</span>
<span class="n">path_input_class</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;F:\HAB_2\PrinzScreen\output_lab_meeting\kerenl_60_mix\class&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">path_input_table</span><span class="p">)</span>
<span class="n">csv_names</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.csv&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">path_input_class</span><span class="p">)</span>
<span class="n">class_names</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.txt&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[202]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table_mix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_input_table</span><span class="p">,</span><span class="n">csv_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">table_mix</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[202]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Index([&#39;Unnamed: 0&#39;, &#39;label&#39;, &#39;area&#39;, &#39;centroid-0&#39;, &#39;centroid-1&#39;,
       &#39;sd_intensity&#39;, &#39;skew_intensity&#39;, &#39;pixelcount&#39;, &#39;mean_int&#39;, &#39;0&#39;, &#39;60&#39;],
      dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">precent_staderisation</span><span class="p">(</span><span class="n">in_list</span><span class="p">):</span>
    <span class="n">max_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">in_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">in_list</span><span class="o">/</span><span class="n">max_</span>

<span class="k">def</span> <span class="nf">add_class</span><span class="p">(</span><span class="n">path_table</span><span class="p">,</span><span class="n">path_class</span><span class="p">,</span><span class="n">table_id</span><span class="p">,</span><span class="n">class_id</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">table_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="n">class_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;the files are missmached&#39;</span><span class="p">)</span>
        <span class="n">quit</span><span class="p">()</span>
    <span class="n">table_mix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_table</span><span class="p">,</span><span class="n">table_id</span><span class="p">))</span>
    <span class="c1"># standerize all to the max</span>
    <span class="n">table_mix</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">precent_staderisation</span><span class="p">(</span> <span class="n">table_mix</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">table_mix</span><span class="p">[</span><span class="s1">&#39;skew_intensity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">precent_staderisation</span><span class="p">(</span> <span class="n">table_mix</span><span class="p">[</span><span class="s1">&#39;skew_intensity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">table_mix</span><span class="p">[</span><span class="s1">&#39;pixelcount&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">precent_staderisation</span><span class="p">(</span> <span class="n">table_mix</span><span class="p">[</span><span class="s1">&#39;pixelcount&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="c1"># calculate precentage</span>
    <span class="n">precent_redaction</span> <span class="o">=</span> <span class="n">table_mix</span><span class="p">[</span><span class="s1">&#39;60&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">table_mix</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">]</span>
    <span class="n">table_mix</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">precent_staderisation</span><span class="p">(</span><span class="n">table_mix</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">table_mix</span><span class="p">[</span><span class="s1">&#39;60&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">table_mix</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">precent_redaction</span>
    <span class="c1"># adding class</span>
    <span class="n">table_mix</span><span class="p">[</span><span class="s1">&#39;image_group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">table_id</span>
    <span class="n">table_mix</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_class</span><span class="p">,</span><span class="n">class_id</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">class_str</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span> <span class="k">for</span> <span class="n">tx</span> <span class="ow">in</span> <span class="n">class_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)]</span>
    <span class="n">table_mix</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">table_mix</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">table_mix</span>
<span class="c1"># for i in range(0):</span>
<span class="n">table_mix_1</span> <span class="o">=</span> <span class="n">add_class</span><span class="p">(</span><span class="n">path_table</span> <span class="o">=</span> <span class="n">path_input_table</span><span class="p">,</span><span class="n">path_class</span> <span class="o">=</span> <span class="n">path_input_class</span><span class="p">,</span><span class="n">table_id</span> <span class="o">=</span> <span class="n">csv_names</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">class_id</span> <span class="o">=</span> <span class="n">class_names</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">table_mix_2</span> <span class="o">=</span> <span class="n">add_class</span><span class="p">(</span><span class="n">path_table</span> <span class="o">=</span> <span class="n">path_input_table</span><span class="p">,</span><span class="n">path_class</span> <span class="o">=</span> <span class="n">path_input_class</span><span class="p">,</span><span class="n">table_id</span> <span class="o">=</span> <span class="n">csv_names</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">class_id</span> <span class="o">=</span> <span class="n">class_names</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">table_mix_3</span> <span class="o">=</span> <span class="n">add_class</span><span class="p">(</span><span class="n">path_table</span> <span class="o">=</span> <span class="n">path_input_table</span><span class="p">,</span><span class="n">path_class</span> <span class="o">=</span> <span class="n">path_input_class</span><span class="p">,</span><span class="n">table_id</span> <span class="o">=</span> <span class="n">csv_names</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">class_id</span> <span class="o">=</span> <span class="n">class_names</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="n">table_mix_4</span> <span class="o">=</span> <span class="n">add_class</span><span class="p">(</span><span class="n">path_table</span> <span class="o">=</span> <span class="n">path_input_table</span><span class="p">,</span><span class="n">path_class</span> <span class="o">=</span> <span class="n">path_input_class</span><span class="p">,</span><span class="n">table_id</span> <span class="o">=</span> <span class="n">csv_names</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">class_id</span> <span class="o">=</span> <span class="n">class_names</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
<span class="n">table_mix_5</span> <span class="o">=</span> <span class="n">add_class</span><span class="p">(</span><span class="n">path_table</span> <span class="o">=</span> <span class="n">path_input_table</span><span class="p">,</span><span class="n">path_class</span> <span class="o">=</span> <span class="n">path_input_class</span><span class="p">,</span><span class="n">table_id</span> <span class="o">=</span> <span class="n">csv_names</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">class_id</span> <span class="o">=</span> <span class="n">class_names</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
<span class="n">table_mix_6</span> <span class="o">=</span> <span class="n">add_class</span><span class="p">(</span><span class="n">path_table</span> <span class="o">=</span> <span class="n">path_input_table</span><span class="p">,</span><span class="n">path_class</span> <span class="o">=</span> <span class="n">path_input_class</span><span class="p">,</span><span class="n">table_id</span> <span class="o">=</span> <span class="n">csv_names</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span><span class="n">class_id</span> <span class="o">=</span> <span class="n">class_names</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
<span class="n">table_mix_7</span> <span class="o">=</span> <span class="n">add_class</span><span class="p">(</span><span class="n">path_table</span> <span class="o">=</span> <span class="n">path_input_table</span><span class="p">,</span><span class="n">path_class</span> <span class="o">=</span> <span class="n">path_input_class</span><span class="p">,</span><span class="n">table_id</span> <span class="o">=</span> <span class="n">csv_names</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">class_id</span> <span class="o">=</span> <span class="n">class_names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[77]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Merge tables</span>
<span class="n">table_mix_sum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">table_mix_7</span><span class="p">,</span><span class="n">table_mix_1</span><span class="p">,</span><span class="n">table_mix_2</span><span class="p">,</span><span class="n">table_mix_3</span><span class="p">,</span><span class="n">table_mix_4</span><span class="p">,</span><span class="n">table_mix_5</span><span class="p">,</span><span class="n">table_mix_6</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">table_mix_sum</span> <span class="o">=</span> <span class="n">table_mix_sum</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span><span class="s1">&#39;unique_id&#39;</span><span class="p">})</span>
<span class="n">table_mix_sum</span><span class="p">[</span><span class="s1">&#39;unique_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">table_mix_sum</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">shuffle</span>
<span class="n">table_mix_sum</span> <span class="o">=</span> <span class="n">shuffle</span><span class="p">(</span><span class="n">table_mix_sum</span><span class="p">)</span>
<span class="n">table_mix_sum</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\ipykernel_launcher.py:2: FutureWarning: In a future version of pandas all arguments of concat except for the argument &#39;objs&#39; will be keyword-only

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[77]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>unique_id</th>
      <th>Unnamed: 0</th>
      <th>label</th>
      <th>area</th>
      <th>centroid-0</th>
      <th>centroid-1</th>
      <th>sd_intensity</th>
      <th>skew_intensity</th>
      <th>pixelcount</th>
      <th>mean_int</th>
      <th>0</th>
      <th>60</th>
      <th>image_group</th>
      <th>class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6179</th>
      <td>6179</td>
      <td>1011</td>
      <td>1011</td>
      <td>0.205692</td>
      <td>1673.808931</td>
      <td>101.584919</td>
      <td>99.576568</td>
      <td>-0.051318</td>
      <td>0.205692</td>
      <td>732.540630</td>
      <td>0.295291</td>
      <td>0.048112</td>
      <td>Table_mix_4_exp001_13DKO_1-4.tif.csv</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3745</th>
      <td>3745</td>
      <td>208</td>
      <td>208</td>
      <td>0.395613</td>
      <td>406.125249</td>
      <td>641.022337</td>
      <td>22.540952</td>
      <td>0.044102</td>
      <td>0.395613</td>
      <td>232.555644</td>
      <td>0.106405</td>
      <td>0.015234</td>
      <td>Table_mix_3_exp001_13DKO_1-3.tif.csv</td>
      <td>0</td>
    </tr>
    <tr>
      <th>9512</th>
      <td>9512</td>
      <td>996</td>
      <td>996</td>
      <td>0.177417</td>
      <td>1389.828785</td>
      <td>1817.807018</td>
      <td>2.992093</td>
      <td>-0.001670</td>
      <td>0.177417</td>
      <td>144.782326</td>
      <td>0.234911</td>
      <td>0.006519</td>
      <td>Table_mix_6_exp001_13DKO_2-2.tif.csv</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>2025</td>
      <td>430</td>
      <td>430</td>
      <td>0.172467</td>
      <td>632.374519</td>
      <td>2022.365541</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.172467</td>
      <td>420.000000</td>
      <td>0.053816</td>
      <td>0.013921</td>
      <td>Table_mix_2_exp001_13DKO_1-2.tif.csv</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2113</th>
      <td>2113</td>
      <td>518</td>
      <td>518</td>
      <td>0.241778</td>
      <td>779.046966</td>
      <td>1259.577310</td>
      <td>71.870118</td>
      <td>0.006801</td>
      <td>0.241778</td>
      <td>269.789875</td>
      <td>0.054806</td>
      <td>0.008942</td>
      <td>Table_mix_2_exp001_13DKO_1-2.tif.csv</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7315</th>
      <td>7315</td>
      <td>273</td>
      <td>273</td>
      <td>0.215227</td>
      <td>408.795462</td>
      <td>1693.520361</td>
      <td>36.048242</td>
      <td>-0.061553</td>
      <td>0.215227</td>
      <td>347.201430</td>
      <td>0.266438</td>
      <td>0.028801</td>
      <td>Table_mix_5_exp001_13DKO_2-1.tif.csv</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5398</th>
      <td>5398</td>
      <td>230</td>
      <td>230</td>
      <td>0.426442</td>
      <td>342.527895</td>
      <td>2472.270304</td>
      <td>89.921826</td>
      <td>-0.027816</td>
      <td>0.426442</td>
      <td>410.796963</td>
      <td>0.140557</td>
      <td>0.026981</td>
      <td>Table_mix_4_exp001_13DKO_1-4.tif.csv</td>
      <td>0</td>
    </tr>
    <tr>
      <th>10014</th>
      <td>10014</td>
      <td>1498</td>
      <td>1498</td>
      <td>0.140469</td>
      <td>2423.846943</td>
      <td>352.729175</td>
      <td>13.061092</td>
      <td>0.027406</td>
      <td>0.140469</td>
      <td>166.816578</td>
      <td>0.288615</td>
      <td>0.007511</td>
      <td>Table_mix_6_exp001_13DKO_2-2.tif.csv</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4527</th>
      <td>4527</td>
      <td>990</td>
      <td>990</td>
      <td>0.132187</td>
      <td>1887.799841</td>
      <td>1640.491842</td>
      <td>7.923222</td>
      <td>-0.133408</td>
      <td>0.132187</td>
      <td>252.558297</td>
      <td>0.078897</td>
      <td>0.016544</td>
      <td>Table_mix_3_exp001_13DKO_1-3.tif.csv</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6296</th>
      <td>6296</td>
      <td>1128</td>
      <td>1128</td>
      <td>0.328038</td>
      <td>1858.100069</td>
      <td>129.476934</td>
      <td>20.632742</td>
      <td>-0.010754</td>
      <td>0.328038</td>
      <td>190.475327</td>
      <td>0.247125</td>
      <td>0.012510</td>
      <td>Table_mix_4_exp001_13DKO_1-4.tif.csv</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>11662 rows × 14 columns</p>
</div></div>
</div>
<section id="Test-and-Training-set">
<h2>Test and Training set<a class="headerlink" href="#Test-and-Training-set" title="Permalink to this headline"></a></h2>
<div class="line-block">
<div class="line">1 is peroxisome negative</div>
<div class="line">0 WT peroxisome Positive</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[146]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">index_class_pos</span> <span class="o">=</span> <span class="n">table_mix_sum</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">table_mix_sum</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;unique_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">index_class_neg</span> <span class="o">=</span> <span class="n">table_mix_sum</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">table_mix_sum</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;unique_id&#39;</span><span class="p">][:</span><span class="mi">100</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">index_class_pos_train</span> <span class="o">=</span> <span class="n">index_class_pos</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span>
<span class="n">index_class_pos_test</span> <span class="o">=</span> <span class="n">index_class_pos</span><span class="p">[</span><span class="mi">50</span><span class="p">:]</span>
<span class="n">index_class_neg_train</span> <span class="o">=</span> <span class="n">index_class_neg</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span>
<span class="n">index_class_neg_test</span> <span class="o">=</span> <span class="n">index_class_neg</span><span class="p">[</span><span class="mi">50</span><span class="p">:]</span>
<span class="n">table_mix_train</span> <span class="o">=</span> <span class="n">table_mix_sum</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">table_mix_sum</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">index_class_pos_train</span> <span class="o">+</span> <span class="n">index_class_neg_train</span><span class="p">),:]</span>
<span class="n">table_mix_test</span>  <span class="o">=</span> <span class="n">table_mix_sum</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">table_mix_sum</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">index_class_pos_test</span> <span class="o">+</span> <span class="n">index_class_neg_test</span><span class="p">),:]</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Features-analysis">
<h1>Features analysis<a class="headerlink" href="#Features-analysis" title="Permalink to this headline"></a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[152]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table_mix_train_features</span> <span class="o">=</span> <span class="n">table_mix_train</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,[</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">13</span><span class="p">]]</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">shuffle</span>
<span class="n">table_mix_train_features</span> <span class="o">=</span> <span class="n">shuffle</span><span class="p">(</span><span class="n">table_mix_train_features</span><span class="p">)</span>
<span class="n">table_mix_train_features</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[152]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>area</th>
      <th>sd_intensity</th>
      <th>skew_intensity</th>
      <th>pixelcount</th>
      <th>0</th>
      <th>60</th>
      <th>class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>11079</th>
      <td>0.301195</td>
      <td>6.211043</td>
      <td>0.008655</td>
      <td>0.301195</td>
      <td>0.236262</td>
      <td>0.014639</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1628</th>
      <td>0.219879</td>
      <td>0.543836</td>
      <td>-0.158870</td>
      <td>0.219879</td>
      <td>0.055574</td>
      <td>0.004870</td>
      <td>1</td>
    </tr>
    <tr>
      <th>7857</th>
      <td>0.209808</td>
      <td>0.421184</td>
      <td>-0.020805</td>
      <td>0.209808</td>
      <td>0.218160</td>
      <td>0.010516</td>
      <td>1</td>
    </tr>
    <tr>
      <th>8379</th>
      <td>0.229544</td>
      <td>2.345267</td>
      <td>-0.111655</td>
      <td>0.229544</td>
      <td>0.615545</td>
      <td>0.016060</td>
      <td>1</td>
    </tr>
    <tr>
      <th>7850</th>
      <td>0.269419</td>
      <td>4.484947</td>
      <td>-0.001366</td>
      <td>0.269419</td>
      <td>0.185663</td>
      <td>0.010721</td>
      <td>1</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>11243</th>
      <td>0.226999</td>
      <td>3.409742</td>
      <td>0.013726</td>
      <td>0.226999</td>
      <td>0.436180</td>
      <td>0.014112</td>
      <td>1</td>
    </tr>
    <tr>
      <th>843</th>
      <td>0.564502</td>
      <td>1.808942</td>
      <td>-0.214585</td>
      <td>0.564502</td>
      <td>0.135251</td>
      <td>0.023938</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4548</th>
      <td>0.254695</td>
      <td>13.223636</td>
      <td>0.022108</td>
      <td>0.254695</td>
      <td>0.186562</td>
      <td>0.010880</td>
      <td>1</td>
    </tr>
    <tr>
      <th>11063</th>
      <td>0.242320</td>
      <td>0.592265</td>
      <td>-0.114036</td>
      <td>0.242320</td>
      <td>0.570960</td>
      <td>0.020125</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4292</th>
      <td>0.204355</td>
      <td>1.431729</td>
      <td>-0.480835</td>
      <td>0.204355</td>
      <td>0.482911</td>
      <td>0.017355</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 7 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[150]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">table_mix_train_temp</span><span class="p">,</span><span class="n">hue</span> <span class="o">=</span> <span class="s1">&#39;class&#39;</span><span class="p">,</span><span class="n">diag_kind</span><span class="o">=</span><span class="s1">&#39;kde&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[150]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;seaborn.axisgrid.PairGrid at 0x28ad5231488&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Multiple_logistic_regression_52_1.png" class="no-scaled-link" src="_images/Multiple_logistic_regression_52_1.png" style="width: 1114px; height: 1061px;" />
</div>
</div>
</section>
<section id="id3">
<h1>Logistic regression<a class="headerlink" href="#id3" title="Permalink to this headline"></a></h1>
<div class="line-block">
<div class="line">Decay formula:</div>
<div class="line-block">
<div class="line">$ Signal(t) = a <span class="math">\times `Signal(t0) :nbsphinx-math:</span>times <cite>e^{-b :nbsphinx-math:</cite>times <a href="#id4"><span class="problematic" id="id5">`</span></a>kernel}$</div>
<div class="line"><span class="math notranslate nohighlight">\(b = - \frac {ln \frac {Signal(t)}{Signal(t0)}}{Kernel}\)</span> Remove the minus sign for compatebility with logistic</div>
</div>
<div class="line">Add a parmetre and beta $ <span class="math">\theta `= logistic(a + :nbsphinx-math:</span>beta <cite>:nbsphinx-math:</cite>frac {ln frac {Signal(t)}{Signal(t0)}}{Kernel}`)$ — Simulation:</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[177]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">table_mix_train_features</span>
<span class="n">y_0</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">codes</span>
<span class="n">x_tzero</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">x_tkernel</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;60&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">x_0</span> <span class="o">=</span> <span class="n">x_tzero</span><span class="o">/</span><span class="n">x_tkernel</span>
<span class="n">kernel</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1">#no need to use this var since it is same</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[199]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">b</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">p</span>  <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span> <span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_0</span><span class="p">))))</span>
<span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[199]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([0.86, 0.81, 0.88, 0.93, 0.86, 0.72, 0.86, 0.76, 0.65, 0.78, 0.76,
       0.7 , 0.82, 0.82, 0.85, 0.85, 0.73, 0.7 , 0.84, 0.76, 0.89, 0.65,
       0.9 , 0.69, 0.93, 0.71, 0.86, 0.64, 0.94, 0.7 , 0.67, 0.91, 0.8 ,
       0.69, 0.79, 0.74, 0.86, 0.89, 0.72, 0.78, 0.87, 0.6 , 0.73, 0.92,
       0.91, 0.72, 0.87, 0.91, 0.86, 0.8 , 0.65, 0.72, 0.9 , 0.71, 0.87,
       0.89, 0.69, 0.71, 0.87, 0.78, 0.89, 0.72, 0.76, 0.87, 0.62, 0.89,
       0.86, 0.75, 0.86, 0.56, 0.91, 0.72, 0.74, 0.69, 0.94, 0.58, 0.85,
       0.86, 0.85, 0.74, 0.85, 0.66, 0.6 , 0.79, 0.9 , 0.69, 0.93, 0.73,
       0.68, 0.83, 0.59, 0.69, 0.71, 0.83, 0.95, 0.92, 0.68, 0.86, 0.91,
       0.91])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[182]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">model_logistic_basic</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">rate</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">pm</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_tkernel</span><span class="o">/</span><span class="n">x_tzero</span><span class="p">)</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">pm</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">pm</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">mu</span><span class="p">)))</span>
    <span class="n">bd</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s1">&#39;bd&#39;</span><span class="p">,</span><span class="o">-</span><span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="p">)</span>
    <span class="n">yl</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Bernoulli</span><span class="p">(</span><span class="s1">&#39;yl&#39;</span><span class="p">,</span><span class="n">theta</span><span class="p">,</span><span class="n">observed</span> <span class="o">=</span> <span class="n">y_0</span><span class="p">)</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">4000</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span> <span class="n">target_accept</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span><span class="n">random_seed</span><span class="o">=</span><span class="n">RANDOM_SEED</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\deprecat\classic.py:215: FutureWarning: In v4.0, pm.sample will return an `arviz.InferenceData` object instead of a `MultiTrace` by default. You can pass return_inferencedata=True or return_inferencedata=False to be safe and silence this warning.
  return wrapped_(*args_, **kwargs_)
Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [b, a]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
  <progress value='32000' class='' max='32000' style='width:300px; height:20px; vertical-align: middle;'></progress>
  100.00% [32000/32000 00:33<00:00 Sampling 4 chains, 0 divergences]
</div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Sampling 4 chains for 4_000 tune and 4_000 draw iterations (16_000 + 16_000 draws total) took 68 seconds.
The number of effective samples is smaller than 25% for some parameters.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[184]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chain_1</span> <span class="o">=</span> <span class="n">trace</span><span class="p">[</span><span class="mi">1000</span><span class="p">:]</span>
<span class="n">pm</span><span class="o">.</span><span class="n">traceplot</span><span class="p">(</span><span class="n">chain_1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\ipykernel_launcher.py:2: DeprecationWarning: The function `traceplot` from PyMC3 is just an alias for `plot_trace` from ArviZ. Please switch to `pymc3.plot_trace` or `arviz.plot_trace`.

Got error No model on context stack. trying to find log_likelihood in translation.
F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\arviz\data\io_pymc3_3x.py:102: FutureWarning: Using `from_pymc3` without the model will be deprecated in a future release. Not using the model will return less accurate and less useful results. Make sure you use the model argument or call from_pymc3 within a model context.
  FutureWarning,
Got error No model on context stack. trying to find log_likelihood in translation.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[184]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[&lt;AxesSubplot:title={&#39;center&#39;:&#39;a&#39;}&gt;,
        &lt;AxesSubplot:title={&#39;center&#39;:&#39;a&#39;}&gt;],
       [&lt;AxesSubplot:title={&#39;center&#39;:&#39;b&#39;}&gt;,
        &lt;AxesSubplot:title={&#39;center&#39;:&#39;b&#39;}&gt;],
       [&lt;AxesSubplot:title={&#39;center&#39;:&#39;theta&#39;}&gt;,
        &lt;AxesSubplot:title={&#39;center&#39;:&#39;theta&#39;}&gt;],
       [&lt;AxesSubplot:title={&#39;center&#39;:&#39;bd&#39;}&gt;,
        &lt;AxesSubplot:title={&#39;center&#39;:&#39;bd&#39;}&gt;]], dtype=object)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Multiple_logistic_regression_57_2.png" class="no-scaled-link" src="_images/Multiple_logistic_regression_57_2.png" style="width: 962px; height: 680px;" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[167]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pm</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Got error No model on context stack. trying to find log_likelihood in translation.
F:\Gil\anaconda\envs\pymc3_cellpose\lib\site-packages\arviz\data\io_pymc3_3x.py:102: FutureWarning: Using `from_pymc3` without the model will be deprecated in a future release. Not using the model will return less accurate and less useful results. Make sure you use the model argument or call from_pymc3 within a model context.
  FutureWarning,
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[167]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_3%</th>
      <th>hdi_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>-1.806</td>
      <td>0.838</td>
      <td>-3.304</td>
      <td>-0.139</td>
      <td>0.017</td>
      <td>0.012</td>
      <td>2423.0</td>
      <td>2526.0</td>
      <td>1.01</td>
    </tr>
    <tr>
      <th>b</th>
      <td>-0.741</td>
      <td>0.333</td>
      <td>-1.376</td>
      <td>-0.110</td>
      <td>0.007</td>
      <td>0.005</td>
      <td>2371.0</td>
      <td>2486.0</td>
      <td>1.01</td>
    </tr>
    <tr>
      <th>theta[0]</th>
      <td>0.562</td>
      <td>0.058</td>
      <td>0.453</td>
      <td>0.669</td>
      <td>0.001</td>
      <td>0.000</td>
      <td>7568.0</td>
      <td>7374.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>theta[1]</th>
      <td>0.499</td>
      <td>0.052</td>
      <td>0.397</td>
      <td>0.592</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>11540.0</td>
      <td>8476.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>theta[2]</th>
      <td>0.606</td>
      <td>0.067</td>
      <td>0.482</td>
      <td>0.734</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>4646.0</td>
      <td>5719.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>theta[96]</th>
      <td>0.375</td>
      <td>0.072</td>
      <td>0.245</td>
      <td>0.516</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>3370.0</td>
      <td>4951.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>theta[97]</th>
      <td>0.573</td>
      <td>0.060</td>
      <td>0.460</td>
      <td>0.684</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>6523.0</td>
      <td>6905.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>theta[98]</th>
      <td>0.657</td>
      <td>0.080</td>
      <td>0.505</td>
      <td>0.805</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>3468.0</td>
      <td>4334.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>theta[99]</th>
      <td>0.654</td>
      <td>0.079</td>
      <td>0.504</td>
      <td>0.801</td>
      <td>0.001</td>
      <td>0.001</td>
      <td>3511.0</td>
      <td>4358.0</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>bd</th>
      <td>-2.368</td>
      <td>4.121</td>
      <td>-3.298</td>
      <td>-1.580</td>
      <td>0.033</td>
      <td>0.024</td>
      <td>12163.0</td>
      <td>5727.0</td>
      <td>1.00</td>
    </tr>
  </tbody>
</table>
<p>103 rows × 9 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[183]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">theta</span> <span class="o">=</span> <span class="n">trace</span><span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">x_0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_0</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span><span class="n">theta</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span><span class="n">color</span> <span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">trace</span><span class="p">[</span><span class="s1">&#39;bd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">bd_hdi</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">hdi</span><span class="p">(</span><span class="n">trace</span><span class="p">[</span><span class="s1">&#39;bd&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">bd_hdi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">bd_hdi</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_0</span><span class="p">,</span><span class="n">y_0</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[183]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x28ad9db2248&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Multiple_logistic_regression_59_1.png" class="no-scaled-link" src="_images/Multiple_logistic_regression_59_1.png" style="width: 547px; height: 413px;" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Gil Kanfer, PhD.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>